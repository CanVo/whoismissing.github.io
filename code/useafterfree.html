<h2 id="use-after-free">Use after free</h2>
<p>Use-after-free is a memory corruption flaw where memory can be accessed after being freed. This can result in a program crash, use of unexpected values, and even code execution.</p>
<p>As seen in the code below, <em>malloc()</em> is called and will return an address that is stored in the pointer &quot;pFree&quot;. Though the pointer is freed, it is used again in the second <em>strcpy()</em> as the pointer still contains the value of the address that <em>malloc()</em> returned.</p>
<p><strong>Mitigation</strong></p>
<p>The mitigating code is to set the value of the pointer to NULL after freeing as well as to create a new pointer when in need of performing another memory allocation.</p>
<p><strong>Vulnerable Code</strong></p>
<pre><code><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span>

<span class="hljs-comment">// use after free example</span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">char</span> * pFree;

    pFree = (<span class="hljs-keyword">char</span> *) <span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">char</span>) * <span class="hljs-number">100</span>);
    <span class="hljs-built_in">strcpy</span>(pFree, <span class="hljs-string">"Hello"</span>);

    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"pFree = %p\n"</span>, pFree);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%s\n"</span>, pFree);

    <span class="hljs-built_in">free</span>(pFree);

    <span class="hljs-comment">// mitigation: NULL the pointer after freeing</span>
    <span class="hljs-comment">// pfree = NULL;</span>

    <span class="hljs-built_in">strcpy</span>(pFree + <span class="hljs-number">5</span>, <span class="hljs-string">" world"</span>);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%s\n"</span>, pFree);

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre><p><strong>Program Output</strong></p>
<pre><code><span class="hljs-attribute">pFree</span> = <span class="hljs-number">0</span>x7f93274027f0
Hello
<span class="hljs-attribute">pFree</span> = <span class="hljs-number">0</span>x7f93274027f0
Hello world
</code></pre>
